<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>教师端-重新分组</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/landscape.css">
    <link rel="stylesheet" href="../../css/group.css">
    <link rel="stylesheet" href="../../font/iconfont.css">
    <style>
        * {
            -webkit-touch-callout: none; /*系统默认菜单被禁用*/
            -webkit-user-select: none; /*webkit浏览器*/
            -khtml-user-select: none; /*早期浏览器*/
            -moz-user-select: none; /*火狐*/
            -ms-user-select: none; /*IE10*/
            user-select: none;
        }
        input{
            -webkit-user-select: auto;
        }
        #diff-group{
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
        }
        #diff-group li{
            width:22%;
            margin: 0 5px;
            margin-bottom: 1rem;
        }
    </style>
    <script type="text/javascript">
        function stops(){
            return false;
        }
        document.oncontextmenu=stops;
    </script>
</head>
<body onload="loadEvent()">
<div class="layout-left close"></div>
<div class="common-content">
    <div class="scores-ranking">分组讨论</div>
    <div class="group-wrapper clearfix">
        <div class="fleft left-wrapper">
            <form action="">
                <div class="group-item">
                    <label for="">班级</label>
                    <div class="group-class">
                        <select name="classd" id="">
                            <option value="class1">英语一班</option>
                            <option value="class1">英语一班</option>
                            <option value="class1">英语一班</option>
                            <option value="class1">英语一班</option>
                        </select>
                    </div>
                </div>
                <div class="group-item">
                    <label for="">任务设置</label>
                    <div class="group-class">
                        <select name="task" id="">
                            <option value="class1">每组语音得分大于80分</option>
                            <option value="class1">每组语音得分大于80分</option>
                        </select>
                    </div>
                </div>
                <div class="group-item">
                    <label>分组方式</label>
                    <div class="group-type-wrapper">
                        <div class="group-type-box clearfix">
                            <label for="sj" class="first-line"><input type="radio" id="sj" name="gtype" value="1">随机分组</label>
                            <label for="zy" class="mid-line"><input type="radio" id="zy" name="gtype" value="2">最优分组</label>
                            <label for="cy" class="last-line active"><input type="radio" id="cy" name="gtype" value="3">差异分组</label>
                        </div>
                    </div>
                    <div class="group-type-wrapper">
                        <div class="group-type-box clearfix">
                            <label for="xb" class="first-line"><input type="radio" id="xb" name="gtype" value="4">性别分组</label>
                            <label for="sd" class="mid-line"><input type="radio" id="sd" name="gtype" value="5">手动分组</label>
                            <label for="hy" class="last-line"><input type="radio" id="hy" name="gtype" value="6">活跃分组</label>
                        </div>
                    </div>
                </div>
                <div class="group-item">
                    <label for="">每组人数</label>
                    <div class="group-process-box change-process-box">
                        <div class="group-process change-process">
                            <p><i></i></p>
                        </div>
                        <input type="text" readonly name="num" value="2" id="group-num">
                    </div>
                </div>
                <!-- <div class="group-item">
                     <label for="">每组人数</label>
                     <div class="group-process-box">
                         <div class="group-process">
                             <p class="process-full"><i></i></p>
                         </div>
                         <input type="text" readonly value="16">
                     </div>
                 </div>-->
                <div class="group-desc">
                    <h3>分组说明</h3>
                    <p>1、根据之前BASIC问卷调查,进行互补最优</p>
                    <p>2、根据之前系统给学生的语音评分,进行互</p>
                    <p>3、可拖动学生头像进行修改分组</p>
                </div>
                <div class="group-submit" onclick="subShare();">确认分配</div>
            </form>
        </div>
        <div class="fright right-wrapper">
            <div class="rebtn-box"><a href="javascript:void(0);" onclick="getList(3,4)"><img src="../../images/refresh.png" alt="refresh-icon"></a></div>
            <ul class='right-content clearfix' id="diff-group">
                <!--<li data-num="A">
                    <div class="item-box">
                        <div class="clearfix item-sub-box">
                            <div class="adver-item">
                                <img src="../../images/user.png" alt="user-icon">
                                <p>Nikki</p>
                            </div>
                            <div class="adver-item">
                                <img src="../../images/user.png" alt="user-icon">
                                <p>Nikki</p>
                            </div>
                            <div class="adver-item">
                                <img src="../../images/user.png" alt="user-icon">
                                <p>Nikki</p>
                            </div>
                            <div class="adver-item">
                                <img src="../../images/user.png" alt="user-icon">
                                <p>Nikki</p>
                            </div>
                        </div>
                    </div>
                    <h3>A组</h3>
                </li>-->
            </ul>
        </div>
    </div>
</div>
<div class="layout-nav-right" style="overflow-y: scroll;"></div>
<!-- 提交分组-->
<div id="page-model11" class="page-model">
    <div class="page-model-box">
        <span class="closed fright" onclick="closed();"><i class="iconfont icon-chahao"></i></span>
        <img src="../../images/diolag6_03.png" alt="">
        <h2>确认分配</h2>
        <p>已完成小组分配，进入练习</p>
        <button class="confirm" onclick="subSharess()">确定</button>
    </div>
</div>
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/landscape.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../js/teacher.js"></script>
<script type="text/javascript">
    var users=JSON.parse(localStorage.getItem('user'));
    var user=users.userLoginname;
    var num=2;//每组人数
    var sysClassId=1;//班级id //暂时在这取值，后续根据班级选择的来取值
    getList(3,num);
    $("input[name='gtype']").on("click",function(){
        if($(this).prop("checked")){
            $(".group-type-box").find("label").removeClass('active');
            $(this).closest('label').addClass('active');
            var values=$(this).val();
            num=$('#group-num').val();
            getList(values,num);
        }
    })
    function subShare(){
        $('#page-model11').fadeIn(500);
    }
    function closed(){
        $('#page-model11').fadeOut(500);
    }

    var array=[];
    var everyObject={};
    function subSharess(){
        $('#page-model11').fadeOut(500);
        array=[];
        $('.right-content li').each(function(){
            var groupId=$(this).data('group');
            $(this).find('.adver-item').each(function(){
                var userLoginname=$(this).children('input[type="hidden"]').val();
                everyObject={};

                everyObject.sysClassId=sysClassId;
                everyObject.sysGroupId=groupId;
                everyObject.userLoginname=userLoginname;
                array.push(everyObject);
            })
        });
        $.ajax({
            type: 'POST',
            url: server + 'tea/group/repartCompanion/confirm?token=' + token,
            data:JSON.stringify(array),
            dataType: "json",
            contentType: 'application/json',
            success: function (back) {
                console.log(back)
            }
        })
    }

    function getList(method,gmaxPnum){
        $('.right-content').html('');
        if(method!=="4"){
            $.ajax({
                type: 'POST',
                url: server + 'tea/group/repart?token=' + token,
                data:{
                    "gmaxPnum":gmaxPnum,
                    "method":method
                },
                dataType: "json",
                success: function (back) {

                    if(back.obj.length>0){
                        for(var i=0;i<back.obj.length;i++){
                            var lis='';
                            lis+='<li data-group="'+(i+1)+'">';
                            lis+='<div class="item-box">';
                            lis+='<div class="clearfix item-sub-box">';
                            for(var j=0;j<back.obj[i].length;j++){
                                lis+='<div class="adver-item">';
                                lis+='<img src="'+back.obj[i][j].userHeadImage+'" alt="user-icon">';
                                lis+='<p>'+back.obj[i][j].userName+'</p>';
                                lis+='<input type="hidden" value="'+back.obj[i][j].userLoginname+'"/>';
                                lis+='</div>';
                            }
                            lis+='</div>';
                            lis+='</div>';
                            lis+='<h3>'+(i+1)+'组</h3>';
                            lis+='</li>';
                            $('.right-content').append(lis);
                        }
                    }
                }
            })
        }else{
            $.ajax({
                type: 'POST',
                url: server + 'tea/group/repart?token=' + token,
                data:{
                    "gmaxPnum":gmaxPnum,
                    "method":method
                },
                dataType: "json",
                success: function (back) {
                    var men=back.obj.men;
                    var number=men.length;
                    var women=back.obj.women;
                    if(men.length>0){
                        for(var i=0;i<men.length;i++){
                            var lis='';
                            lis+='<li data-group="'+(i+1)+'">';
                            lis+='<div class="item-box">';
                            lis+='<div class="clearfix item-sub-box">';
                            if(men[i].length>0){
                                for(var j=0;j<men[i].length;j++){

                                    lis+='<div class="adver-item">';
                                    lis+='<img src="'+men[i][j].userHeadImage+'" alt="user-icon">';
                                    lis+='<p>'+men[i][j].userName+'</p>';
                                    lis+='<input type="hidden" value="'+men[i][j].userLoginname+'"/>';
                                    lis+='</div>';
                                }
                            }
                            lis+='</div>';
                            lis+='</div>';
                            lis+='<h3>'+(i+1)+'组</h3>';
                            lis+='</li>';
                            $('.right-content').append(lis);
                        }
                    }
                    if(women.length>0){
                        for(var i=0;i<women.length;i++){
                            var lis='';
                            lis+='<li data-group="'+(number+i+1)+'">';
                            lis+='<div class="item-box">';
                            lis+='<div class="clearfix item-sub-box">';
                            if(men[i].length>0){
                                for(var j=0;j<women[i].length;j++){
                                    lis+='<div class="adver-item">';
                                    lis+='<img src="'+women[i][j].userHeadImage+'" alt="user-icon">';
                                    lis+='<p>'+women[i][j].userName+'</p>';
                                    lis+='<input type="hidden" value="'+women[i][j].userLoginname+'"/>';
                                    lis+='</div>';
                                }
                            }
                            lis+='</div>';
                            lis+='</div>';
                            lis+='<h3>'+(number+i+1)+'组</h3>';
                            lis+='</li>';
                            $('.right-content').append(lis);
                        }
                    }
                }
            })
        }

    }
    $(function(){
        var tag = false;
        var startx = 0;
        var left = 0;
        var bgleft = 0;
        var len = $(".change-process").width();
        /*$(".change-process").on("mousedown",'i',function(e){
         processDown(e);
         })
         $(".change-process").on('mousemove',function(e){
         proressmove(e)
         })

         $(".change-process").on("touchstart",'i',function(e){
         processDown(e);
         })
         $(".change-process").on('touchmove',function(e){
         proressmove(e)
         })*/
        $(document).mouseup(function() {
            proressend()
        });

        function processDown(e){
            tag = true;
            if(e.originalEvent.touches){
                startx = e.originalEvent.targetTouches[0].pageX - left;
            }else{
                startx = e.pageX - left;
            }
        }

        function proressend(){
            flag = false;
        }
        /*function proressmove(e){
         if(tag) {
         if(e.originalEvent.touches){
         left = e.originalEvent.targetTouches[0].pageX - startx;
         }else{
         left = e.pageX - startx;
         }

         if(left <= 0) {
         left = 0;
         }else if(left > len) {
         left = len;
         }
         $(".change-process p").width(left)
         var num = Math.floor((left*16)/len)
         $("#group-num").val(num)
         }
         e.preventDefault();
         }*/
    })

    function loadEvent(){
        if(IsPC()){
            ;(function($){
                var tag = true;
                $(document).on("mousedown",'.adver-item',function(e){
                    var that = $(this);
                    if(tag){
                        tag = false;
                        var ox = $(that).offset().left;
                        var oy = $(that).offset().top;
                        var disx = e.pageX - ox; //获取的拖拽过程的短线的长度（鼠标的位置离盒子边缘的位置）
                        var disy = e.pageY - oy;
                        var leftd,topd;
                        $(that).closest('li').addClass('old');
                        var $clone = $(that).clone(); //克隆
                        $clone.addClass('act').css({ //对克隆的盒子设置类名以及位置
                            left: ox,
                            top: oy,
                        });

                        $(that).closest(".item-sub-box").append($clone);
                        $(that).html('');

                        $(document).on('mousemove',function(e){
                            e.preventDefault();
                            leftd = e.pageX - disx;
                            topd = e.pageY -  disy;
                            $clone.css({
                                left: leftd,
                                top: topd
                            })
                        })

                        var boxd = $(".right-content>li").not('.old');
                        $(document).on('mouseup',function(){
                            boxd.each(function(index,item){
                                var left = $(item).offset().left;
                                var top = $(item).offset().top;
                                var bottom = $(item).height()+top;
                                var right = $(item).width()+left;
                                if(parseInt(Math.floor(leftd)) >= parseInt(Math.floor(left)) && parseInt(Math.floor(leftd)) <= parseInt(Math.floor(right)) && parseInt(Math.floor(topd)) >= parseInt(Math.floor(top)) && parseInt(Math.floor(topd)) <= parseInt(Math.floor(bottom))){
                                    var indexd = $(item).index();
                                    $(".right-content>li").eq(indexd).find('.item-sub-box').append($clone);
                                    $(that).closest('li').find($clone).remove();
                                    $clone.removeClass('act');
                                    $(that).remove();
                                }else{
                                    $clone.removeClass('act');
                                    $(that).remove();
                                }
                            })
                            $(".adver-item").removeAttr("style")
                            $(".old").removeClass('old');
                            $(document).off('mousemove');
                            tag = true;
                            return false;
                        })
                    }
                })
            })($)
        }else{
            ;(function($){
                var tag = true
                $(document).on("touchstart",'.adver-item',function(e){
                    var that = $(this);
                    if(tag){
                        tag = false;
                        var ox = $(that).offset().left;
                        var oy = $(that).offset().top;
                        var disx = e.originalEvent.changedTouches[0].pageX - ox; //获取的拖拽过程的短线的长度（鼠标的位置离盒子边缘的位置）
                        var disy = e.originalEvent.changedTouches[0].pageY - oy;
                        var leftd,topd;
                        $(that).closest('li').addClass('old');
                        $clone = $(that).clone(); //克隆
                        $clone.addClass('act').css({ //对克隆的盒子设置类名以及位置
                            left: ox,
                            top: oy,
                        });

                        $(that).closest(".item-sub-box").append($clone);
                        $(that).html('');

                        $clone.on("touchmove",function(e){
                            e.preventDefault();
                            leftd = e.originalEvent.targetTouches[0].pageX - disx;
                            topd = e.originalEvent.targetTouches[0].pageY - disy;
                            $clone.css({
                                left: leftd,
                                top: topd
                            })
                        })

                        var boxd = $(".right-content>li").not('.old');
                        $clone.on('touchend',function(){
                            if(leftd && leftd != 'undefined'){
                                boxd.each(function(index,item){
                                    var left = $(item).offset().left;
                                    var top = $(item).offset().top;
                                    var bottom = $(item).height()+top;
                                    var right = $(item).width()+left;
                                    if(parseInt(Math.floor(leftd)) >= parseInt(Math.floor(left)) && parseInt(Math.floor(leftd)) <= parseInt(Math.floor(right)) && parseInt(Math.floor(topd)) >= parseInt(Math.floor(top)) && parseInt(Math.floor(topd)) <= parseInt(Math.floor(bottom))){
                                        var indexd = $(item).index();
                                        $(".right-content>li").eq(indexd).find('.item-sub-box').append($clone);
                                        $(".old").find($clone).remove();
                                        $clone.removeClass('act');
                                        $clone.css({'left':'',top:''})
                                        $(that).remove();
                                    }else{
                                        $clone.removeClass('act');
                                        $clone.css({'left':'',top:''})
                                        $(that).remove();
                                    }
                                })
                            }else{
                                $clone.removeClass('act');
                                $clone.css({'left':'',top:''})
                                $(that).remove();
                            }

                            $(".old").removeClass('old');
                            $(document).off('touchend');
                            $(".adver-item").removeAttr("style")
                            tag = true;
                            return false;
                        })
                    }
                })
            })($)
        }
    }

    function IsPC() {
        var userAgentInfo = navigator.userAgent;
        var Agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) {
                flag = false;
                break;
            }
        }
        return flag;
    }
</script>
</body>
</html>
